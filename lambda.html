<!DOCTYPE html>
<meta charset="UTF-8">
<html>
  <head> </head>
  <body style = "align-items: center; justify-content: center;">
    <textarea id="in" style="display: block; width: 90vw; height: 90vh; resize: none; overflow: auto;"></textarea>
    <b id="out"> </b>
  </body>




  <script src="./peg-0.10.0.js"></script>

  <script>
    var parser= peg.generate(String.raw `
    {
      function changevar (f, x, y) {
          if (f.apply != undefined) return {apply: changevar(f.exp,x,y), to:changevar(f.exp,x,y)};
            else if(f.abstraction != undefined) return {abstraction: f.abstraction, exp:changevar(f.exp,x,y)};
            else return f == x ? y : f;
        
        }
      function _eval(x) {
        if (x.apply != undefined && x.to.abstraction != undefined ) return changevar(x.to.exp, x.to.abstraction, x.apply);
        else if (x.apply != undefined && x.to.apply != undefined) return {apply:x.apply, to:_eval(x.to)};
        else return x;
      return x;
      }
    }

    program = e:exp { 
      var last;
      for(last=_eval(e);last != _eval(last); last=_eval(last));
      return last;
    }

    exp = "(" _ f:exp x:exp2 _ ")" {return {apply:x, to:f}}
      / "(" e:exp ")" { return e; }
      / v:var _ "\=\>" _ e:exp  {return {abstraction:v, exp:e}}
        / val:var {return val;} 

    exp2 = __ e:exp {return e;}

    var = $[a-zA-Z]+

    __ = [\ \n\t]+
    _ = __?

    `);

    document.getElementById('in').addEventListener("input", (evt) => {

      try {
        document.getElementById('out').innerText = (parser.parse(evt.target.value))
        } 
      catch(e) {
        document.getElementById('out').innerText=(e.message);
      };


    });
  </script>


</html>
